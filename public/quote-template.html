<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Istanbul Dental Smile – Quote Summary</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      padding: 40px;
    }
    .quote-box {
      background: white;
      max-width: 800px;
      margin: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #00688B;
    }
    h2 {
      color: #007B9E;
      margin-top: 40px;
    }
    .icon {
      height: 16px;
      width: 16px;
      vertical-align: middle;
      margin-right: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f5f5f5;
    }
    button {
      margin-top: 30px;
      padding: 10px 20px;
      background: #00688B;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .highlight {
      background-color: #00688B;
      color: white;
    }
    .savings {
      color: #B2904F;
      font-weight: bold;
    }
    .footer {
      margin-top: 40px;
      font-size: 12px;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="quote-box" id="quote-container">
    <h1>Istanbul Dental Smile</h1>
    <p><strong>Quote #:</strong> <span id="quote-number">Loading...</span></p>
    <p><strong>Date:</strong> <span id="quote-date">Loading...</span></p>

    <h2>Patient Information</h2>
    <p><strong>Name:</strong> <span id="patient-name">Loading...</span></p>
    <p><strong>Email:</strong> <span id="patient-email">Loading...</span></p>
    <p><strong>Phone:</strong> <span id="patient-phone">Loading...</span></p>

    <h2>Your Quote Details</h2>
    <table>
      <thead>
        <tr>
          <th>Treatment</th>
          <th>Price (GBP)</th>
          <th>Price (USD)</th>
          <th>Qty</th>
          <th>Guarantee</th>
        </tr>
      </thead>
      <tbody id="treatments-table">
        <tr>
          <td colspan="5" style="text-align: center;">Loading treatments...</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3"><strong>Total</strong></td>
          <td colspan="2"><strong>£<span id="total-gbp">0</span> / $<span id="total-usd">0</span></strong></td>
        </tr>
      </tfoot>
    </table>

    <div id="travel-section" style="display: none;">
      <h2>Travel Information</h2>
      <p><strong>Travel Month:</strong> <span id="travel-month">Not specified</span></p>
      <p><strong>Departure City:</strong> <span id="departure-city">Not specified</span></p>
      
      <div id="flight-cost-section" style="display: none;">
        <h3>Estimated Flight Cost</h3>
        <p>The average return flight from <span id="flight-city">your city</span> to Istanbul in <span id="flight-month">selected month</span> costs approximately <strong>£<span id="flight-cost">0</span></strong>.</p>
      </div>
    </div>

    <h2>Clinic Comparison</h2>
    <table>
      <thead>
        <tr>
          <th>Clinic Name</th>
          <th>Price (GBP)</th>
          <th>Package Includes</th>
        </tr>
      </thead>
      <tbody id="clinics-comparison">
        <tr>
          <td colspan="3" style="text-align: center;">Loading comparison...</td>
        </tr>
      </tbody>
    </table>

    <h2>UK Cost Comparison</h2>
    <p>The same treatment in the UK would typically cost between <strong>£<span id="uk-min-cost">0</span> and £<span id="uk-max-cost">0</span></strong>.<br>
    By choosing Istanbul, you save approximately <strong class="savings">£<span id="savings-amount">0</span></strong> (<span id="savings-percent">0</span>% savings).</p>

    <h2>Why Book With Us?</h2>
    <ul>
      <li><img src="icons/tick.png" class="icon" /> Free Consultation & Treatment Plan</li>
      <li><img src="icons/tick.png" class="icon" /> VIP Airport Transfers Included</li>
      <li><img src="icons/tick.png" class="icon" /> 5-Star Hotel Accommodation Options</li>
      <li><img src="icons/tick.png" class="icon" /> English-Speaking Staff Throughout Your Stay</li>
      <li><img src="icons/tick.png" class="icon" /> Dedicated Patient Coordinator Available 24/7</li>
      <li><img src="icons/tick.png" class="icon" /> All Treatments with Written Guarantees</li>
    </ul>

    <h2>Next Steps</h2>
    <ol>
      <li>Contact Istanbul Dental Smile to confirm your treatment plan</li>
      <li>Book your flight to Istanbul for your chosen dates</li>
      <li>We will arrange airport transfer and accommodation options</li>
    </ol>

    <h2>Ready to Book?</h2>
    <p>Email us at <strong>info@istanbuldentalsmile.com</strong> or message us on WhatsApp: <strong>+447572445856</strong><br>
    We'll handle your travel, treatment, and care — all you do is show up and smile!</p>

    <button onclick="downloadPDF()">Download Quote as PDF</button>

    <div class="footer">
      <p>Quote valid for 30 days from date of issue. Prices subject to change without notice.</p>
      <p>Istanbul Dental Smile is a registered medical tourism facilitator. Dental services are provided by our partner clinics.</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Get quote data from sessionStorage
        const quoteDataString = sessionStorage.getItem('quoteData');
        if (!quoteDataString) {
          document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>Error: No quote data found</h2><p>Please generate a quote first and try again.</p></div>';
          return;
        }
        
        const quoteData = JSON.parse(quoteDataString);
        
        // Format a number with commas for thousands
        const formatNumber = (num) => {
          return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        };
        
        // Fill in the quote details
        document.getElementById('quote-number').textContent = quoteData.quoteNumber;
        document.getElementById('quote-date').textContent = quoteData.date;
        document.getElementById('patient-name').textContent = quoteData.patientName || 'Not provided';
        document.getElementById('patient-email').textContent = quoteData.patientEmail || 'Not provided';
        document.getElementById('patient-phone').textContent = quoteData.patientPhone || 'Not provided';
        
        // Calculate UK costs (assume 2.5x to 3x more expensive)
        const ukMinCost = Math.round(quoteData.totalGBP * 2.5);
        const ukMaxCost = Math.round(quoteData.totalGBP * 3.0);
        const savingsAmount = Math.round((ukMinCost + ukMaxCost) / 2 - quoteData.totalGBP);
        const savingsPercent = Math.round((savingsAmount / ((ukMinCost + ukMaxCost) / 2)) * 100);
        
        document.getElementById('uk-min-cost').textContent = formatNumber(ukMinCost);
        document.getElementById('uk-max-cost').textContent = formatNumber(ukMaxCost);
        document.getElementById('savings-amount').textContent = formatNumber(savingsAmount);
        document.getElementById('savings-percent').textContent = savingsPercent;
        
        document.getElementById('total-gbp').textContent = formatNumber(quoteData.totalGBP);
        document.getElementById('total-usd').textContent = formatNumber(quoteData.totalUSD);
        
        // Fill in treatments table
        const treatmentsTable = document.getElementById('treatments-table');
        treatmentsTable.innerHTML = '';
        
        quoteData.items.forEach(item => {
          const row = document.createElement('tr');
          
          const treatmentCell = document.createElement('td');
          treatmentCell.textContent = item.treatment.replace(/(\w)([A-Z])/g, '$1 $2').split('_').join(' ');
          
          const gbpCell = document.createElement('td');
          gbpCell.textContent = `£${formatNumber(item.priceGBP)}`;
          
          const usdCell = document.createElement('td');
          usdCell.textContent = `$${formatNumber(item.priceUSD)}`;
          
          const qtyCell = document.createElement('td');
          qtyCell.textContent = item.quantity;
          
          const guaranteeCell = document.createElement('td');
          guaranteeCell.textContent = item.guarantee;
          
          row.appendChild(treatmentCell);
          row.appendChild(gbpCell);
          row.appendChild(usdCell);
          row.appendChild(qtyCell);
          row.appendChild(guaranteeCell);
          
          treatmentsTable.appendChild(row);
        });
        
        // Handle travel information
        if (quoteData.travelMonth || quoteData.departureCity) {
          document.getElementById('travel-section').style.display = 'block';
          document.getElementById('travel-month').textContent = quoteData.travelMonth || 'Not specified';
          document.getElementById('departure-city').textContent = quoteData.departureCity || 'Not specified';
          
          if (quoteData.flightEstimate && quoteData.flightEstimate > 0) {
            document.getElementById('flight-cost-section').style.display = 'block';
            document.getElementById('flight-city').textContent = quoteData.departureCity;
            document.getElementById('flight-month').textContent = quoteData.travelMonth;
            document.getElementById('flight-cost').textContent = formatNumber(quoteData.flightEstimate);
          }
        }
        
        // Fill in clinic comparison
        const clinicsTable = document.getElementById('clinics-comparison');
        clinicsTable.innerHTML = '';
        
        // Create fake clinic comparisons based on the total cost
        const clinics = [
          {
            name: "Istanbul Dental Smile",
            price: quoteData.totalGBP,
            includes: [
              { icon: "hotel.png", text: "5★ Hotel" }, 
              { icon: "car.png", text: "VIP Transfer" },
              { icon: "chat.png", text: "24/7 Support" }
            ],
            highlight: true
          },
          {
            name: "Premium Dental Turkey",
            price: Math.round(quoteData.totalGBP * 1.05),
            includes: [
              { icon: "hotel.png", text: "4★ Hotel" }, 
              { icon: "car.png", text: "Airport Transfer" }
            ]
          },
          {
            name: "Vera Smile Clinic",
            price: Math.round(quoteData.totalGBP * 0.95),
            includes: [
              { icon: "car.png", text: "Airport Transfer" }
            ]
          }
        ];
        
        clinics.forEach(clinic => {
          const row = document.createElement('tr');
          if (clinic.highlight) {
            row.className = 'highlight';
          }
          
          const nameCell = document.createElement('td');
          nameCell.textContent = clinic.name;
          
          const priceCell = document.createElement('td');
          priceCell.textContent = `£${formatNumber(clinic.price)}`;
          
          const includesCell = document.createElement('td');
          
          clinic.includes.forEach((item, index) => {
            const img = document.createElement('img');
            img.src = `icons/${item.icon}`;
            img.className = 'icon';
            includesCell.appendChild(img);
            
            const text = document.createTextNode(item.text);
            includesCell.appendChild(text);
            
            if (index < clinic.includes.length - 1) {
              includesCell.appendChild(document.createTextNode(' · '));
            }
          });
          
          row.appendChild(nameCell);
          row.appendChild(priceCell);
          row.appendChild(includesCell);
          
          clinicsTable.appendChild(row);
        });
      });
      
      function downloadPDF() {
        const element = document.getElementById('quote-container');
        const opt = {
          margin: 10,
          filename: 'IstanbulDentalSmile_Quote.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        html2pdf().set(opt).from(element).save();
      }
    </script>
  </div>
</body>
</html>