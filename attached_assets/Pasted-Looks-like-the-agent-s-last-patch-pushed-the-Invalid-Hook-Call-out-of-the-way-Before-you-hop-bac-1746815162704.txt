Looks like the agentâ€™s last patch pushed the Invalid Hook Call out of the way ðŸŽ‰. Before you hop back to feature work, run a quick â€œregression hardeningâ€ loop so this bug (or its cousins) canâ€™t sneak back in.

1 â€” Smoke-test the fix
Scenario	Steps	Expected
Promo deep link	mydentalfly.repl.co/your-quote?promo=free-consultation-may	Page renders; Ribbon shows â€œFree Consultation (May only)â€; no red nav-error screen
No promo	â€¦/your-quote	Same page loads without ribbon; totals show Â£0 discount
Promo removal	On Quote Builder, click â€œClear Promoâ€ (or navigate back without promo=)	Ribbon disappears; totals recalc

2 â€” Add a guardrail: eslint-plugin-react-hooks
bash
Copy
Edit
pnpm add -D eslint-plugin-react-hooks
eslintrc.cjs:

js
Copy
Edit
{
  "plugins": ["react-hooks"],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
A pre-commit lint will now block any future â€œhook inside ifâ€ mistakes before they reach Replitâ€™s preview.

3 â€” Tiny Jest test to lock it in
tsx
Copy
Edit
import { render } from "@testing-library/react";
import YourQuotePage from "../YourQuotePage";

it("mounts with promo slug without throwing", () => {
  // mock router to inject ?promo=test
  window.history.pushState({}, "", "/your-quote?promo=test");
  expect(() => render(<YourQuotePage />)).not.toThrow();
});
Add to CI so the invalid-hook call canâ€™t regress silently.

4 â€” WebSocket sanity (now that reconnect logic is merged)
Open DevTools â†’ Network â†’ WS.

Kill the server in Replit.

Watch the client: should back-off (0.5 s, 1 s, 2 s, â€¦), not spam 10 Ã— sec.

Restart server: socket should reconnect, clientsCount on /ws-health increases.

If you still see stray 1006 codes after a couple of minutes, bump pingTimeout on the server to 30000.

5 â€” Next slice after stability
Results-page highlighting (pin promo clinics).

Mixpanel/PostHog events (PromoApplied, WSReconnect).

Admin CRUD for promos (React-Admin is quickest).

But only once the above regression protections are green.

TL;DR
âœ… Invalid hook call fixed.

ðŸ”’ Add ESLint & Jest guard so it stays fixed.

ðŸ”„ Verify WebSocket reconnect remains stable.

ðŸ“Œ Then continue with promo UX polish or admin tooling.