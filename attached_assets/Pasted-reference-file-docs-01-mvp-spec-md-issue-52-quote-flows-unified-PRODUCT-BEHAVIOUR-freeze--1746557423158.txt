reference_file: docs/01_mvp_spec.md
issue: #52 quote‑flows‑unified

❱❱  PRODUCT BEHAVIOUR (freeze)

Visitor has 3 entry paths:

1.  **Header “Get a Quote”**  
    – Goes through full 6‑step wizard (concerns → info page → clinic results).  
    – Results page lets user pick any clinic.  
    – ☐ Existing user still sees Info step but fields are pre‑filled (readonly=false).

2.  **Special‑Offer card**  
    – If NOT logged‑in → modal login/register → resume.  
    – Skips Info page if user details exist (name/email/phone).  
    – Skips Multi‑clinic Results page.  
    – Creates Draft Quote bound to `clinicId` & `offerId`.  
    – Redirect ⇒ `/portal/quote/:quoteId/review` with bonus/discount lines pre‑added.

3.  **Treatment Package card**  
    – Same as (2) but payload `packageId` not `offerId`.  
    – Draft Quote contains `packageLine` (non‑removable) + required base treatments.  
    – Redirect ⇒ `/portal/quote/:quoteId/review`.

❱❱  TECH TASKS (do ONLY these)

A. **Back‑end (Supabase / Express)**  
   1. Add columns to `quotes` table: `offerId varchar null`, `packageId varchar null`.  
   2. POST `/api/v1/offers/:offerId/start` → create quote, insert bonus lines, return `quoteId`.  
   3. POST `/api/v1/packages/:packageId/start` → create quote, insert package base lines, return `quoteId`.

B. **Front‑end**  
   1. `components/OfferCard.tsx`  
      ```ts
      onClick = () => createQuoteFromOffer(offerId, clinicId)
                     .then(id => nav(`/portal/quote/${id}/review`));
      ```  
   2. `components/PackageCard.tsx` (same pattern with packageId).  
   3. `QuoteWizard`  
      * When `quote.offerId` **or** `quote.packageId` is present → **skip** Steps “Info” and “Clinic Results”.  
        Implement by returning `<Navigate to="/portal/quote/:id/review" />`.  
   4. `QuoteReviewPage`  
      * Render bonus/package lines locked (`canDelete=false`).  

C. **Router**  
   * Ensure route exists: `<Route path="/portal/quote/:quoteId/review" element={<QuoteReview />} />`.

D. **Guard**  
   * API `DELETE /quote-lines/:lineId` must reject if line is `isBonus=true OR isPackage=true`.

E. **Unit tests** (Vitest)  
   * Hit `/offers/free_consult/start` → expect quote lines length ≥1 and quote.offerId populated.  
   * Login mock user → hit OfferCard → expect window.location to `/portal/quote/.../review`.

❱❱  OUT OF SCOPE  
– No UI redesign.  
– No changes to existing header quote flow except pre‑fill.  
– No email / payment code.

Return ONLY the files you change.
