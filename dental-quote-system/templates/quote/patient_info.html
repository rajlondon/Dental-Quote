{% extends "base.html" %}

{% block title %}Patient Information | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col">
            <h1 class="fw-bold">Patient Information</h1>
            <p class="lead">Please provide your details to complete your dental quote</p>
        </div>
    </div>
    
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <form id="patientInfoForm" action="{{ url_for('review_quote') }}" method="post" class="needs-validation" novalidate>
                        <!-- Personal Information -->
                        <h5 class="mb-4">Personal Information</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" name="first_name" 
                                       value="{{ patient_info.first_name if patient_info else '' }}" required>
                                <div class="invalid-feedback">
                                    First name is required.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" name="last_name" 
                                       value="{{ patient_info.last_name if patient_info else '' }}" required>
                                <div class="invalid-feedback">
                                    Last name is required.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       value="{{ patient_info.email if patient_info else '' }}" required>
                                <div class="invalid-feedback">
                                    Please provide a valid email address.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       value="{{ patient_info.phone if patient_info else '' }}" required>
                                <div class="invalid-feedback">
                                    Phone number is required.
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="country" class="form-label">Country of Residence</label>
                                <select class="form-select" id="country" name="country" required>
                                    <option value="" disabled selected>Select your country</option>
                                    {% for country in countries %}
                                    <option value="{{ country }}" {% if patient_info and patient_info.country == country %}selected{% endif %}>
                                        {{ country }}
                                    </option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">
                                    Please select your country.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Treatment Preferences -->
                        <h5 class="mb-4">Treatment Preferences</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="preferredMonth" class="form-label">Preferred Travel Month</label>
                                <select class="form-select" id="preferredMonth" name="preferred_month">
                                    <option value="" disabled selected>Select preferred month</option>
                                    <option value="1" {% if patient_info and patient_info.preferred_month == '1' %}selected{% endif %}>January</option>
                                    <option value="2" {% if patient_info and patient_info.preferred_month == '2' %}selected{% endif %}>February</option>
                                    <option value="3" {% if patient_info and patient_info.preferred_month == '3' %}selected{% endif %}>March</option>
                                    <option value="4" {% if patient_info and patient_info.preferred_month == '4' %}selected{% endif %}>April</option>
                                    <option value="5" {% if patient_info and patient_info.preferred_month == '5' %}selected{% endif %}>May</option>
                                    <option value="6" {% if patient_info and patient_info.preferred_month == '6' %}selected{% endif %}>June</option>
                                    <option value="7" {% if patient_info and patient_info.preferred_month == '7' %}selected{% endif %}>July</option>
                                    <option value="8" {% if patient_info and patient_info.preferred_month == '8' %}selected{% endif %}>August</option>
                                    <option value="9" {% if patient_info and patient_info.preferred_month == '9' %}selected{% endif %}>September</option>
                                    <option value="10" {% if patient_info and patient_info.preferred_month == '10' %}selected{% endif %}>October</option>
                                    <option value="11" {% if patient_info and patient_info.preferred_month == '11' %}selected{% endif %}>November</option>
                                    <option value="12" {% if patient_info and patient_info.preferred_month == '12' %}selected{% endif %}>December</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="stayDuration" class="form-label">Planned Stay Duration (Days)</label>
                                <input type="number" class="form-control" id="stayDuration" name="stay_duration" min="1" 
                                       value="{{ patient_info.stay_duration if patient_info else '' }}">
                            </div>
                            <div class="col-12">
                                <label for="additionalServices" class="form-label">Interested in Additional Services</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="accommodationHelp" name="accommodation_help" 
                                           {% if patient_info and patient_info.accommodation_help %}checked{% endif %}>
                                    <label class="form-check-label" for="accommodationHelp">
                                        Help with accommodation arrangements
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="transportHelp" name="transport_help" 
                                           {% if patient_info and patient_info.transport_help %}checked{% endif %}>
                                    <label class="form-check-label" for="transportHelp">
                                        Airport transfer and local transportation
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="translatorHelp" name="translator_help" 
                                           {% if patient_info and patient_info.translator_help %}checked{% endif %}>
                                    <label class="form-check-label" for="translatorHelp">
                                        Translator/interpreter services
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Medical Information -->
                        <h5 class="mb-4">Medical Information</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="allergies" class="form-label">Do you have any allergies or medical conditions?</label>
                                <textarea class="form-control" id="allergies" name="allergies" rows="3" 
                                          placeholder="Please list any allergies or medical conditions that our dental team should be aware of.">{{ patient_info.allergies if patient_info else '' }}</textarea>
                            </div>
                            <div class="col-12">
                                <label for="medications" class="form-label">Are you currently taking any medications?</label>
                                <textarea class="form-control" id="medications" name="medications" rows="3" 
                                          placeholder="Please list any medications you are currently taking.">{{ patient_info.medications if patient_info else '' }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Additional Comments -->
                        <h5 class="mb-4">Additional Information</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="comments" class="form-label">Additional Comments or Questions</label>
                                <textarea class="form-control" id="comments" name="comments" rows="4" 
                                          placeholder="Please provide any additional information or questions you have about your treatment.">{{ patient_info.comments if patient_info else '' }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Communication Preferences -->
                        <h5 class="mb-4">Communication Preferences</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="receiveUpdates" name="receive_updates" 
                                           {% if patient_info and patient_info.receive_updates %}checked{% endif %}>
                                    <label class="form-check-label" for="receiveUpdates">
                                        I would like to receive updates about my quote and special offers
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="contactConsent" name="contact_consent" required 
                                           {% if patient_info and patient_info.contact_consent %}checked{% endif %}>
                                    <label class="form-check-label" for="contactConsent">
                                        I consent to being contacted by MyDentalFly regarding my dental quote *
                                    </label>
                                    <div class="invalid-feedback">
                                        You must consent to being contacted to proceed.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{{ url_for('quote_builder') }}" class="btn btn-outline-secondary">Back to Quote Builder</a>
                            <button type="submit" class="btn btn-primary">Continue to Review</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Quote Summary Sidebar -->
        <div class="col-lg-4">
            <div class="card shadow-sm mb-4 sticky-top" style="top: 20px; z-index: 999;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Your Quote Summary</h5>
                </div>
                <div class="card-body">
                    <!-- Selected Treatments -->
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">Selected Treatments</h6>
                        <ul class="list-group list-group-flush">
                            {% for treatment in selected_treatments %}
                            <li class="list-group-item px-0 d-flex justify-content-between">
                                <div>
                                    <span>{{ treatment.name }}</span>
                                    <span class="d-block text-muted small">Quantity: {{ treatment.quantity }}</span>
                                </div>
                                <span class="fw-bold">${{ (treatment.price * treatment.quantity) }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- Promo Code Applied -->
                    {% if promo_code %}
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">Promotional Code</h6>
                        <div class="d-flex justify-content-between p-3 bg-light rounded">
                            <div>
                                <strong>{{ promo_code }}</strong>
                                {% if promo_details %}
                                <div class="small text-success">{{ promo_details.description }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Pricing -->
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">Pricing</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>${{ subtotal }}</span>
                        </div>
                        {% if discount > 0 %}
                        <div class="d-flex justify-content-between mb-2">
                            <span>Discount:</span>
                            <span class="text-success">-${{ discount }}</span>
                        </div>
                        {% endif %}
                        <div class="d-flex justify-content-between fw-bold">
                            <span>Total:</span>
                            <span>${{ total }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.getElementById('patientInfoForm');
        
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        });
    });
</script>
{% endblock %}