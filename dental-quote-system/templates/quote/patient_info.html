{% extends "base.html" %}

{% block title %}Patient Information | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <h2 class="card-title fw-bold mb-4">Patient Information</h2>
                    
                    <!-- Progress Indicator -->
                    <div class="progress mb-5" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 66%;" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-center mb-5">
                        <div>
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Treatments</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>2</span>
                            </div>
                            <div class="small fw-bold">Patient Info</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>3</span>
                            </div>
                            <div class="small">Review</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>4</span>
                            </div>
                            <div class="small">Confirmation</div>
                        </div>
                    </div>
                    
                    <form id="patient-info-form" method="POST" action="{{ url_for('save_patient_info') }}">
                        <div class="row g-3">
                            <!-- Personal Information -->
                            <div class="col-12">
                                <h5 class="fw-bold mb-3">Personal Information</h5>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" value="{{ patient_info.first_name if patient_info else '' }}" required>
                                    <label for="first_name">First Name</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" value="{{ patient_info.last_name if patient_info else '' }}" required>
                                    <label for="last_name">Last Name</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" value="{{ patient_info.email if patient_info else '' }}" required>
                                    <label for="email">Email Address</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone" value="{{ patient_info.phone if patient_info else '' }}" required>
                                    <label for="phone">Phone Number</label>
                                </div>
                            </div>
                            
                            <!-- Travel Preferences -->
                            <div class="col-12 mt-4">
                                <h5 class="fw-bold mb-3">Travel Preferences</h5>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="country" name="country" required>
                                        <option value="">Select your country</option>
                                        <option value="UK" {% if patient_info and patient_info.country == 'UK' %}selected{% endif %}>United Kingdom</option>
                                        <option value="USA" {% if patient_info and patient_info.country == 'USA' %}selected{% endif %}>United States</option>
                                        <option value="Canada" {% if patient_info and patient_info.country == 'Canada' %}selected{% endif %}>Canada</option>
                                        <option value="Australia" {% if patient_info and patient_info.country == 'Australia' %}selected{% endif %}>Australia</option>
                                        <option value="Germany" {% if patient_info and patient_info.country == 'Germany' %}selected{% endif %}>Germany</option>
                                        <option value="France" {% if patient_info and patient_info.country == 'France' %}selected{% endif %}>France</option>
                                        <option value="Other" {% if patient_info and patient_info.country == 'Other' %}selected{% endif %}>Other</option>
                                    </select>
                                    <label for="country">Country of Residence</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="travel_month" name="travel_month">
                                        <option value="">When do you plan to travel?</option>
                                        <option value="ASAP" {% if patient_info and patient_info.travel_month == 'ASAP' %}selected{% endif %}>As soon as possible</option>
                                        <option value="1-month" {% if patient_info and patient_info.travel_month == '1-month' %}selected{% endif %}>Within 1 month</option>
                                        <option value="2-3-months" {% if patient_info and patient_info.travel_month == '2-3-months' %}selected{% endif %}>2-3 months</option>
                                        <option value="4-6-months" {% if patient_info and patient_info.travel_month == '4-6-months' %}selected{% endif %}>4-6 months</option>
                                        <option value="6-plus-months" {% if patient_info and patient_info.travel_month == '6-plus-months' %}selected{% endif %}>More than 6 months</option>
                                        <option value="not-sure" {% if patient_info and patient_info.travel_month == 'not-sure' %}selected{% endif %}>Not sure yet</option>
                                    </select>
                                    <label for="travel_month">Preferred Travel Timeframe</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="travel_companions" name="travel_companions">
                                        <option value="">Will you travel with companions?</option>
                                        <option value="alone" {% if patient_info and patient_info.travel_companions == 'alone' %}selected{% endif %}>Traveling alone</option>
                                        <option value="with-partner" {% if patient_info and patient_info.travel_companions == 'with-partner' %}selected{% endif %}>With partner/spouse</option>
                                        <option value="with-family" {% if patient_info and patient_info.travel_companions == 'with-family' %}selected{% endif %}>With family</option>
                                        <option value="with-friends" {% if patient_info and patient_info.travel_companions == 'with-friends' %}selected{% endif %}>With friends</option>
                                        <option value="not-decided" {% if patient_info and patient_info.travel_companions == 'not-decided' %}selected{% endif %}>Not decided yet</option>
                                    </select>
                                    <label for="travel_companions">Travel Companions</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="accommodation_preference" name="accommodation_preference">
                                        <option value="">Accommodation preference?</option>
                                        <option value="budget" {% if patient_info and patient_info.accommodation_preference == 'budget' %}selected{% endif %}>Budget-friendly</option>
                                        <option value="mid-range" {% if patient_info and patient_info.accommodation_preference == 'mid-range' %}selected{% endif %}>Mid-range</option>
                                        <option value="luxury" {% if patient_info and patient_info.accommodation_preference == 'luxury' %}selected{% endif %}>Luxury</option>
                                        <option value="no-preference" {% if patient_info and patient_info.accommodation_preference == 'no-preference' %}selected{% endif %}>No preference</option>
                                        <option value="own-arrangements" {% if patient_info and patient_info.accommodation_preference == 'own-arrangements' %}selected{% endif %}>Making own arrangements</option>
                                    </select>
                                    <label for="accommodation_preference">Accommodation Preference</label>
                                </div>
                            </div>
                            
                            <!-- Medical Information -->
                            <div class="col-12 mt-4">
                                <h5 class="fw-bold mb-3">Medical Information</h5>
                            </div>
                            
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="medical_conditions" name="medical_conditions" style="height: 100px" placeholder="Medical conditions">{{ patient_info.medical_conditions if patient_info else '' }}</textarea>
                                    <label for="medical_conditions">Do you have any medical conditions we should know about?</label>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="additional_notes" name="additional_notes" style="height: 100px" placeholder="Additional notes">{{ patient_info.additional_notes if patient_info else '' }}</textarea>
                                    <label for="additional_notes">Additional Notes or Questions</label>
                                </div>
                            </div>
                            
                            <!-- Consent -->
                            <div class="col-12 mt-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="privacy_consent" name="privacy_consent" required>
                                    <label class="form-check-label" for="privacy_consent">
                                        I consent to MyDentalFly processing my personal data to provide dental tourism services and to contact me about my quote. See our <a href="#" target="_blank">Privacy Policy</a>.
                                    </label>
                                </div>
                            </div>
                            
                            <div class="col-12 mt-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="marketing_consent" name="marketing_consent">
                                    <label class="form-check-label" for="marketing_consent">
                                        I agree to receive marketing communications about special offers and promotions (optional).
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-5">
                            <a href="{{ url_for('quote_builder') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Back to Quote Builder
                            </a>
                            <button type="submit" class="btn btn-primary">
                                Continue to Review <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Quote Summary Panel -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0">Your Quote Summary</h5>
                </div>
                <div class="card-body p-0">
                    {% include 'quote/partials/quote_summary.html' %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation feedback
        const patientForm = document.getElementById('patient-info-form');
        
        patientForm.addEventListener('submit', function(event) {
            if (!patientForm.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            patientForm.classList.add('was-validated');
        });
    });
</script>
{% endblock %}