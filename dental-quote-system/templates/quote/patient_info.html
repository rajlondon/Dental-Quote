{% extends "base.html" %}

{% block title %}Patient Information | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Patient Information Form -->
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <h2 class="card-title fw-bold mb-4">Your Information</h2>
                    
                    <!-- Progress Indicator -->
                    <div class="progress mb-5" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 66%;" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-center mb-5">
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Treatments</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>2</span>
                            </div>
                            <div class="small fw-bold">Patient Info</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>3</span>
                            </div>
                            <div class="small">Review</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>4</span>
                            </div>
                            <div class="small">Confirmation</div>
                        </div>
                    </div>
                    
                    <form id="patientInfoForm" method="POST" action="{{ url_for('patient_info') }}">
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="first_name" class="form-label fw-medium">First Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="first_name" name="first_name" value="{{ patient_info.first_name or '' }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="last_name" class="form-label fw-medium">Last Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="last_name" name="last_name" value="{{ patient_info.last_name or '' }}" required>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label fw-medium">Email Address <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="email" name="email" value="{{ patient_info.email or '' }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label fw-medium">Phone Number <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="{{ patient_info.phone or '' }}" required>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="country" class="form-label fw-medium">Country <span class="text-danger">*</span></label>
                                <select class="form-select" id="country" name="country" required>
                                    <option value="" disabled {% if not patient_info.country %}selected{% endif %}>Select your country</option>
                                    {% for country in countries %}
                                    <option value="{{ country }}" {% if patient_info.country == country %}selected{% endif %}>{{ country }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="preferred_dates" class="form-label fw-medium">Preferred Treatment Dates</label>
                                <input type="text" class="form-control" id="preferred_dates" name="preferred_dates" placeholder="e.g., June 15-25" value="{{ patient_info.preferred_dates or '' }}">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="fw-medium mb-2">Travel Preferences</div>
                            <div class="form-check form-check-inline mb-2">
                                <input class="form-check-input" type="checkbox" id="accommodation_needed" name="accommodation_needed" {% if patient_info.accommodation_needed %}checked{% endif %}>
                                <label class="form-check-label" for="accommodation_needed">I need assistance with accommodation</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="airport_transfer_needed" name="airport_transfer_needed" {% if patient_info.airport_transfer_needed %}checked{% endif %}>
                                <label class="form-check-label" for="airport_transfer_needed">I need airport transfer</label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="additional_notes" class="form-label fw-medium">Additional Notes or Questions</label>
                            <textarea class="form-control" id="additional_notes" name="additional_notes" rows="3">{{ patient_info.additional_notes or '' }}</textarea>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-5">
                            <a href="{{ url_for('quote_builder') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </a>
                            <button type="submit" class="btn btn-primary">
                                Continue <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light py-3">
                    <h5 class="card-title mb-0">Information Security</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-shield-alt fa-lg"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-bold mb-1">Your Data is Secure</h6>
                            <p class="small text-muted mb-0">We use industry-standard encryption to protect your personal information. Your data is never shared with third parties without your explicit consent.</p>
                        </div>
                    </div>
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-headset fa-lg"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-bold mb-1">Personalized Support</h6>
                            <p class="small text-muted mb-0">Our team will contact you shortly after submission to discuss your treatment options and answer any questions you may have.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quote Summary Section -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 20px; z-index: 100;">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0">Your Quote Summary</h5>
                </div>
                <div class="card-body p-0">
                    {% include 'quote/partials/quote_summary.html' %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.getElementById('patientInfoForm');
        
        form.addEventListener('submit', function(event) {
            let valid = true;
            
            // Check required fields
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(function(field) {
                if (!field.value.trim()) {
                    valid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            // Check email format
            const emailField = document.getElementById('email');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailField.value.trim() && !emailPattern.test(emailField.value)) {
                valid = false;
                emailField.classList.add('is-invalid');
                if (!emailField.nextElementSibling || !emailField.nextElementSibling.classList.contains('invalid-feedback')) {
                    const feedback = document.createElement('div');
                    feedback.className = 'invalid-feedback';
                    feedback.textContent = 'Please enter a valid email address';
                    emailField.parentNode.appendChild(feedback);
                }
            }
            
            if (!valid) {
                event.preventDefault();
            }
        });
        
        // Remove validation styling on input
        form.querySelectorAll('input, select, textarea').forEach(function(field) {
            field.addEventListener('input', function() {
                this.classList.remove('is-invalid');
            });
        });
    });
</script>
{% endblock %}

{% block extra_css %}
.form-control:focus,
.form-select:focus {
    border-color: #80bdff;
    box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
}
.form-control.is-invalid,
.form-select.is-invalid {
    border-color: #dc3545;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
.sticky-top {
    position: -webkit-sticky;
    position: sticky;
}
{% endblock %}