{% extends "base.html" %}

{% block title %}Special Offers | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="fw-bold mb-2">Special Offers</h1>
            <p class="lead text-muted mb-5">Discover exclusive deals on dental treatments from our partner clinics in Turkey.</p>
            
            <!-- Offer Filters -->
            <div class="card shadow-sm mb-5">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="fw-bold mb-0">Filter Offers</h5>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="text" class="form-control" id="offerSearch" placeholder="Search offers...">
                                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <div class="row">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <label for="treatmentType" class="form-label fw-medium">Treatment Type</label>
                            <select class="form-select" id="treatmentType">
                                <option value="all" selected>All Treatments</option>
                                <option value="implants">Dental Implants</option>
                                <option value="veneers">Veneers</option>
                                <option value="crowns">Crowns</option>
                                <option value="whitening">Teeth Whitening</option>
                                <option value="orthodontics">Orthodontics</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3 mb-md-0">
                            <label for="discountType" class="form-label fw-medium">Discount Type</label>
                            <select class="form-select" id="discountType">
                                <option value="all" selected>All Discounts</option>
                                <option value="percentage">Percentage Off</option>
                                <option value="fixed">Fixed Amount Off</option>
                                <option value="free">Free Add-ons</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="sortBy" class="form-label fw-medium">Sort By</label>
                            <select class="form-select" id="sortBy">
                                <option value="featured" selected>Featured</option>
                                <option value="highest">Highest Discount</option>
                                <option value="newest">Newest</option>
                                <option value="expiring">Expiring Soon</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Featured Offers -->
            <div class="mb-5">
                <h3 class="fw-bold mb-4">Featured Offers</h3>
                <div class="row">
                    {% for offer in featured_offers %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm offer-card">
                            {% if offer.banner_image %}
                            <div class="position-relative">
                                <img src="{{ offer.banner_image }}" class="card-img-top" alt="{{ offer.title }}" style="height: 200px; object-fit: cover;">
                                <div class="position-absolute top-0 end-0 m-3">
                                    <span class="badge bg-primary">{{ offer.discount_type|capitalize }} Offer</span>
                                </div>
                            </div>
                            {% endif %}
                            <div class="card-body">
                                <h5 class="card-title fw-bold mb-2">{{ offer.title }}</h5>
                                <p class="card-text text-muted mb-3">{{ offer.description }}</p>
                                <div class="d-flex align-items-center mb-3">
                                    <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center flex-shrink-0 me-2" style="width: 40px; height: 40px;">
                                        {% if offer.discount_type == 'percentage' %}
                                        <i class="fas fa-percent"></i>
                                        {% elif offer.discount_type == 'fixed_amount' %}
                                        <i class="fas fa-euro-sign"></i>
                                        {% else %}
                                        <i class="fas fa-gift"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <div class="small text-muted">Discount</div>
                                        <div class="fw-bold">
                                            {% if offer.discount_type == 'percentage' %}
                                            {{ offer.discount_value }}% Off
                                            {% elif offer.discount_type == 'fixed_amount' %}
                                            â‚¬{{ offer.discount_value }} Off
                                            {% else %}
                                            {{ offer.title }}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="small text-muted mb-1">Applicable Treatments</div>
                                    <div>
                                        {% for treatment in offer.applicable_treatments[:3] %}
                                        <span class="badge bg-light text-dark me-1 mb-1">{{ treatment|replace('_', ' ')|capitalize }}</span>
                                        {% endfor %}
                                        {% if offer.applicable_treatments|length > 3 %}
                                        <span class="badge bg-light text-dark mb-1">+{{ offer.applicable_treatments|length - 3 }} more</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% if offer.terms_conditions %}
                                <div class="small text-muted mb-3">
                                    <i class="fas fa-info-circle me-1"></i> {{ offer.terms_conditions|truncate(80) }}
                                </div>
                                {% endif %}
                                <a href="{{ url_for('apply_offer', offer_id=offer.id) }}" class="btn btn-primary w-100">
                                    Get This Offer
                                </a>
                            </div>
                            <div class="card-footer bg-white">
                                <div class="d-flex justify-content-between align-items-center small text-muted">
                                    <span>
                                        <i class="far fa-clock me-1"></i> 
                                        Expires: {{ (offer.end_date or 'N/A')|truncate(10, True, '') }}
                                    </span>
                                    <span>
                                        <i class="fas fa-tag me-1"></i> {{ offer.promo_code }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- All Offers -->
            <div>
                <h3 class="fw-bold mb-4">All Special Offers</h3>
                <div class="row">
                    {% for offer in special_offers %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm offer-card">
                            {% if offer.banner_image %}
                            <div class="position-relative">
                                <img src="{{ offer.banner_image }}" class="card-img-top" alt="{{ offer.title }}" style="height: 200px; object-fit: cover;">
                                <div class="position-absolute top-0 end-0 m-3">
                                    <span class="badge bg-primary">{{ offer.discount_type|capitalize }} Offer</span>
                                </div>
                            </div>
                            {% endif %}
                            <div class="card-body">
                                <h5 class="card-title fw-bold mb-2">{{ offer.title }}</h5>
                                <p class="card-text text-muted mb-3">{{ offer.description }}</p>
                                <div class="d-flex align-items-center mb-3">
                                    <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center flex-shrink-0 me-2" style="width: 40px; height: 40px;">
                                        {% if offer.discount_type == 'percentage' %}
                                        <i class="fas fa-percent"></i>
                                        {% elif offer.discount_type == 'fixed_amount' %}
                                        <i class="fas fa-euro-sign"></i>
                                        {% else %}
                                        <i class="fas fa-gift"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <div class="small text-muted">Discount</div>
                                        <div class="fw-bold">
                                            {% if offer.discount_type == 'percentage' %}
                                            {{ offer.discount_value }}% Off
                                            {% elif offer.discount_type == 'fixed_amount' %}
                                            â‚¬{{ offer.discount_value }} Off
                                            {% else %}
                                            {{ offer.title }}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="small text-muted mb-1">Applicable Treatments</div>
                                    <div>
                                        {% for treatment in offer.applicable_treatments[:3] %}
                                        <span class="badge bg-light text-dark me-1 mb-1">{{ treatment|replace('_', ' ')|capitalize }}</span>
                                        {% endfor %}
                                        {% if offer.applicable_treatments|length > 3 %}
                                        <span class="badge bg-light text-dark mb-1">+{{ offer.applicable_treatments|length - 3 }} more</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% if offer.terms_conditions %}
                                <div class="small text-muted mb-3">
                                    <i class="fas fa-info-circle me-1"></i> {{ offer.terms_conditions|truncate(80) }}
                                </div>
                                {% endif %}
                                <a href="{{ url_for('apply_offer', offer_id=offer.id) }}" class="btn btn-primary w-100">
                                    Get This Offer
                                </a>
                            </div>
                            <div class="card-footer bg-white">
                                <div class="d-flex justify-content-between align-items-center small text-muted">
                                    <span>
                                        <i class="far fa-clock me-1"></i> 
                                        Expires: {{ (offer.end_date or 'N/A')|truncate(10, True, '') }}
                                    </span>
                                    <span>
                                        <i class="fas fa-tag me-1"></i> {{ offer.promo_code }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-5">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Filter functionality
        const searchInput = document.getElementById('offerSearch');
        const treatmentSelect = document.getElementById('treatmentType');
        const discountSelect = document.getElementById('discountType');
        const sortSelect = document.getElementById('sortBy');
        const searchButton = document.getElementById('searchButton');
        const offerCards = document.querySelectorAll('.offer-card');
        
        // Simple search and filter (client-side for demo)
        function filterOffers() {
            const searchTerm = searchInput.value.toLowerCase();
            const treatmentFilter = treatmentSelect.value;
            const discountFilter = discountSelect.value;
            
            offerCards.forEach(function(card) {
                const title = card.querySelector('.card-title').textContent.toLowerCase();
                const description = card.querySelector('.card-text').textContent.toLowerCase();
                
                // Simple search logic - this would be server-side in a real implementation
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.parentElement.style.display = 'block';
                } else {
                    card.parentElement.style.display = 'none';
                }
            });
        }
        
        searchButton.addEventListener('click', filterOffers);
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                filterOffers();
            }
        });
        
        treatmentSelect.addEventListener('change', filterOffers);
        discountSelect.addEventListener('change', filterOffers);
        sortSelect.addEventListener('change', filterOffers);
    });
</script>
{% endblock %}

{% block extra_css %}
.bg-opacity-10 {
    --bs-bg-opacity: 0.1;
}
.offer-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.offer-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}
.card-img-top {
    border-top-left-radius: calc(0.5rem - 1px);
    border-top-right-radius: calc(0.5rem - 1px);
}
{% endblock %}