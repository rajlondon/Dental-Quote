{% extends "base.html" %}

{% block title %}Quote Confirmation | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Confirmation Message -->
            <div class="card shadow-sm text-center mb-5">
                <div class="card-body p-5">
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px;">
                        <i class="fas fa-check fa-3x"></i>
                    </div>
                    
                    <h2 class="fw-bold mb-3">Quote Successfully Submitted!</h2>
                    <p class="text-muted mb-4">Thank you for your interest in dental treatments in Turkey. Your quote has been successfully created and sent to your email at <strong>{{ patient_info.email }}</strong>.</p>
                    
                    <div class="alert alert-primary mb-4" role="alert">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle fa-lg"></i>
                            </div>
                            <div class="ms-3 text-start">
                                <h6 class="alert-heading fw-bold mb-1">Your Quote Reference</h6>
                                <p class="mb-0">Please save your quote reference number: <strong>{{ quote_reference }}</strong></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Indicator -->
                    <div class="progress mb-5" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-center mb-5">
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Treatments</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Patient Info</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Review</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small fw-bold">Confirmation</div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-center">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-primary mx-2">
                            <i class="fas fa-home me-2"></i> Return to Home
                        </a>
                        <a href="{{ url_for('download_quote_pdf', quote_id=quote_id) }}" class="btn btn-primary mx-2">
                            <i class="fas fa-file-pdf me-2"></i> Download Quote PDF
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- What Happens Next -->
            <div class="card shadow-sm mb-5">
                <div class="card-body p-4">
                    <h4 class="fw-bold mb-4 text-center">Next Steps</h4>
                    
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-point bg-primary"></div>
                            <div class="timeline-content">
                                <h5 class="fw-bold">1. Check Your Email</h5>
                                <p class="mb-0">We've sent a copy of your quote to <strong>{{ patient_info.email }}</strong>. If you don't see it, please check your spam folder.</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-point bg-primary"></div>
                            <div class="timeline-content">
                                <h5 class="fw-bold">2. Initial Consultation (Within 24 Hours)</h5>
                                <p class="mb-0">A MyDentalFly representative will contact you within 24 hours to discuss your treatment options and answer any questions you may have.</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-point bg-primary"></div>
                            <div class="timeline-content">
                                <h5 class="fw-bold">3. Connect with Clinics</h5>
                                <p class="mb-0">We'll connect you with the most suitable dental clinics in Turkey based on your treatment needs and preferences.</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-point bg-primary"></div>
                            <div class="timeline-content">
                                <h5 class="fw-bold">4. Treatment Planning & Booking</h5>
                                <p class="mb-0">Once you're ready to proceed, we'll help you finalize your treatment plan and book your appointment at your chosen clinic.</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-point bg-primary"></div>
                            <div class="timeline-content">
                                <h5 class="fw-bold">5. Travel Arrangements</h5>
                                <p class="mb-0">We'll assist you with travel planning, accommodation recommendations, and provide pre-departure information to ensure a smooth journey.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- FAQ Section -->
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h4 class="fw-bold mb-4">Frequently Asked Questions</h4>
                    
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Is the quote final, or can prices change?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <p class="mb-0">The quote provided is an estimate based on the information you've shared. Final treatment costs may vary slightly after your initial examination at the clinic, as the dentist may identify additional needs or adjustments to your treatment plan. However, we strive to ensure that our quotes are as accurate as possible, and any significant changes would be discussed with you before proceeding.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    How soon can I travel for my treatment?
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <p class="mb-0">Appointment availability varies depending on the treatment, clinic, and season. Generally, we can arrange appointments within 2-4 weeks from booking. During your consultation, our representative will discuss available dates that work with your schedule and the clinic's availability.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    What if I need to change my treatment plan?
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <p class="mb-0">You can modify your treatment plan at any time before confirming your appointment. Simply contact your MyDentalFly representative to discuss changes, and we'll adjust your quote accordingly. Even after arriving at the clinic, you can discuss modifications with your dentist if needed, though significant changes may affect your treatment timeline.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    Is there a deposit required to book my treatment?
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <p class="mb-0">Most clinics require a small deposit (typically 10-20% of the total treatment cost) to secure your appointment. This deposit is deducted from your final treatment cost. The deposit requirement, amount, and payment methods will be explained during your consultation.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    What about aftercare and guarantees?
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <p class="mb-0">All our partner clinics offer guarantees on their dental work, ranging from 1-10 years depending on the treatment. Detailed aftercare instructions will be provided, and the clinics offer remote support after you return home. For any concerns, you can contact both the clinic directly and our MyDentalFly support team for assistance.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Information -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top mb-4" style="top: 20px; z-index: 100;">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0">Contact Support</h5>
                </div>
                <div class="card-body p-4">
                    <p class="mb-4">If you have any questions or need assistance, our customer support team is here to help.</p>
                    
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-envelope"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-bold mb-1">Email</h6>
                            <p class="mb-0"><a href="mailto:support@mydentalfly.com" class="text-decoration-none">support@mydentalfly.com</a></p>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-bold mb-1">Phone</h6>
                            <p class="mb-0"><a href="tel:+441234567890" class="text-decoration-none">+44 123 456 7890</a> (UK)</p>
                            <p class="mb-0"><a href="tel:+902123456789" class="text-decoration-none">+90 212 345 6789</a> (Turkey)</p>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-4">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-bold mb-1">WhatsApp</h6>
                            <p class="mb-0"><a href="https://wa.me/441234567890" class="text-decoration-none" target="_blank">+44 123 456 7890</a></p>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h6 class="fw-bold mb-3">Share Your Quote</h6>
                    <div class="d-flex justify-content-center">
                        <a href="mailto:?subject=My%20Dental%20Treatment%20Quote&body=Check%20out%20my%20dental%20treatment%20quote%20from%20MyDentalFly:%20{{ quote_reference }}" class="btn btn-outline-primary me-2">
                            <i class="fas fa-envelope"></i>
                        </a>
                        <a href="https://wa.me/?text=Check%20out%20my%20dental%20treatment%20quote%20from%20MyDentalFly:%20{{ quote_reference }}" class="btn btn-outline-primary me-2" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="#" class="btn btn-outline-primary">
                            <i class="far fa-copy"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Quote Summary Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-light py-3">
                    <h5 class="card-title mb-0">Quote Summary</h5>
                </div>
                <div class="card-body p-4">
                    <ul class="list-unstyled mb-4">
                        {% for treatment in selected_treatments %}
                        <li class="mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <p class="fw-medium mb-0">{{ treatment.name }}</p>
                                    <small class="text-muted">Qty: {{ treatment.quantity }}</small>
                                </div>
                                <div class="text-end">
                                    <p class="fw-bold mb-0">€{{ "%.2f"|format(treatment.total_price) }}</p>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span class="fw-bold">€{{ "%.2f"|format(subtotal) }}</span>
                    </div>
                    
                    {% if discount_amount > 0 %}
                    <div class="d-flex justify-content-between mb-2 text-success">
                        <span>Discount</span>
                        <span class="fw-bold">-€{{ "%.2f"|format(discount_amount) }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span>VAT ({{ vat_rate }}%)</span>
                        <span class="fw-bold">€{{ "%.2f"|format(vat_amount) }}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-3">
                        <span class="fw-bold">Total</span>
                        <span class="fw-bold fs-5">€{{ "%.2f"|format(total) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy quote reference to clipboard
        const copyButton = document.querySelector('.far.fa-copy').parentElement;
        if (copyButton) {
            copyButton.addEventListener('click', function(e) {
                e.preventDefault();
                const quoteReference = '{{ quote_reference }}';
                navigator.clipboard.writeText(quoteReference).then(function() {
                    alert('Quote reference copied to clipboard!');
                });
            });
        }
    });
</script>
{% endblock %}

{% block extra_css %}
.bg-opacity-10 {
    --bs-bg-opacity: 0.1;
}
.sticky-top {
    position: -webkit-sticky;
    position: sticky;
}
.timeline {
    position: relative;
    padding-left: 30px;
}
.timeline-item {
    position: relative;
    margin-bottom: 30px;
}
.timeline-point {
    position: absolute;
    left: -30px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    top: 5px;
}
.timeline::before {
    content: "";
    position: absolute;
    height: 100%;
    width: 2px;
    background-color: #dee2e6;
    left: -21px;
    top: 0;
}
{% endblock %}