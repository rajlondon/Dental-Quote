{% extends "base.html" %}

{% block title %}Review Your Quote | MyDentalFly{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Review Quote Section -->
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <h2 class="card-title fw-bold mb-4">Review Your Quote</h2>
                    
                    <!-- Progress Indicator -->
                    <div class="progress mb-5" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 90%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-center mb-5">
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Treatments</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="small">Patient Info</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>3</span>
                            </div>
                            <div class="small fw-bold">Review</div>
                        </div>
                        <div>
                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 30px; height: 30px;">
                                <span>4</span>
                            </div>
                            <div class="small">Confirmation</div>
                        </div>
                    </div>
                    
                    <div class="mb-5">
                        <div class="alert alert-primary d-flex" role="alert">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle fa-lg"></i>
                            </div>
                            <div class="ms-3">
                                <p class="mb-0">Please review your quote details below. If everything looks correct, click the "Confirm Quote" button to proceed.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quote ID & Date -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="bg-light rounded p-3">
                                <div class="small text-muted">Quote Reference</div>
                                <div class="fw-bold">{{ quote_id }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bg-light rounded p-3">
                                <div class="small text-muted">Date</div>
                                <div class="fw-bold">{{ now().strftime('%d %B, %Y') }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selected Treatments -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="card-title mb-0">Selected Treatments</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="ps-4">Treatment</th>
                                            <th class="text-center">Quantity</th>
                                            <th class="text-center">Unit Price</th>
                                            <th class="text-end pe-4">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for treatment in selected_treatments %}
                                        <tr>
                                            <td class="ps-4">
                                                <div class="fw-medium">{{ treatment.name }}</div>
                                                <div class="small text-muted">{{ treatment.description | truncate(80) }}</div>
                                            </td>
                                            <td class="text-center align-middle">{{ treatment.quantity }}</td>
                                            <td class="text-center align-middle">€{{ "%.2f"|format(treatment.price) }}</td>
                                            <td class="text-end align-middle pe-4 fw-bold">€{{ "%.2f"|format(treatment.price * treatment.quantity) }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <div class="row">
                                <div class="col-md-8 col-lg-9"></div>
                                <div class="col-md-4 col-lg-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted">Subtotal:</span>
                                        <span class="fw-medium">€{{ "%.2f"|format(subtotal) }}</span>
                                    </div>
                                    
                                    {% if promo_code %}
                                    <div class="d-flex justify-content-between mb-2">
                                        <div>
                                            <span class="text-muted">Discount:</span>
                                            <span class="badge bg-primary ms-2">{{ promo_code }}</span>
                                        </div>
                                        <span class="fw-medium text-danger">-€{{ "%.2f"|format(discount) }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="d-flex justify-content-between border-top pt-2 mt-2">
                                        <span class="fw-bold">Total:</span>
                                        <span class="fw-bold">€{{ "%.2f"|format(total) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Patient Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="card-title mb-0">Patient Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="small text-muted">Full Name</div>
                                    <div class="fw-medium">{{ patient_info.first_name }} {{ patient_info.last_name }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="small text-muted">Email</div>
                                    <div class="fw-medium">{{ patient_info.email }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="small text-muted">Phone</div>
                                    <div class="fw-medium">{{ patient_info.phone }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="small text-muted">Country</div>
                                    <div class="fw-medium">{{ patient_info.country }}</div>
                                </div>
                                {% if patient_info.preferred_dates %}
                                <div class="col-md-6 mb-3">
                                    <div class="small text-muted">Preferred Dates</div>
                                    <div class="fw-medium">{{ patient_info.preferred_dates }}</div>
                                </div>
                                {% endif %}
                                
                                <div class="col-12 mb-3">
                                    <div class="small text-muted">Travel Preferences</div>
                                    <div class="fw-medium">
                                        {% if patient_info.accommodation_needed %}
                                        <span class="badge bg-primary me-2">Accommodation Needed</span>
                                        {% endif %}
                                        {% if patient_info.airport_transfer_needed %}
                                        <span class="badge bg-primary">Airport Transfer Needed</span>
                                        {% endif %}
                                        {% if not patient_info.accommodation_needed and not patient_info.airport_transfer_needed %}
                                        <span class="text-muted">None selected</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                {% if patient_info.additional_notes %}
                                <div class="col-12">
                                    <div class="small text-muted">Additional Notes</div>
                                    <div class="fw-medium">{{ patient_info.additional_notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="card-title mb-0">Next Steps</h5>
                        </div>
                        <div class="card-body">
                            <ol class="mb-0">
                                <li class="mb-2">After confirming your quote, you'll receive a copy via email.</li>
                                <li class="mb-2">Our specialist will contact you within 24 hours to discuss your treatment options.</li>
                                <li class="mb-2">We'll help arrange your travel and accommodation if needed.</li>
                                <li>Once you're ready to proceed, a small deposit will secure your booking.</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-5">
                        <a href="{{ url_for('patient_info') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i> Back
                        </a>
                        <a href="{{ url_for('confirmation') }}" class="btn btn-primary">
                            Confirm Quote <i class="fas fa-check ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quote Summary Section -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 20px; z-index: 100;">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0">Your Quote Summary</h5>
                </div>
                <div class="card-body p-0">
                    {% include 'quote/partials/quote_summary.html' %}
                </div>
            </div>
            
            <div class="card mt-4 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="card-title fw-bold mb-3">Why Choose Us?</h5>
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-star text-primary"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-medium mb-1">Verified Clinics</h6>
                            <p class="small text-muted mb-0">All clinics are thoroughly vetted and certified.</p>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-user-md text-primary"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-medium mb-1">Expert Dentists</h6>
                            <p class="small text-muted mb-0">Internationally trained specialists with years of experience.</p>
                        </div>
                    </div>
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-thumbs-up text-primary"></i>
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="fw-medium mb-1">Satisfaction Guarantee</h6>
                            <p class="small text-muted mb-0">97% of our patients report complete satisfaction.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
.table th {
    font-weight: 600;
}
.sticky-top {
    position: -webkit-sticky;
    position: sticky;
}
{% endblock %}